---
#Setup Ingress Controller for the cluster
- name: Install Ingress Controller mandatory dependencies
  shell: |
    export KUBECONFIG=/etc/kubernetes/admin.conf
    kubectl apply -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/master/deploy/mandatory.yaml 

# Proxy requests of different size
- name: Proxy requests of different size
  shell: |
    export KUBECONFIG=/etc/kubernetes/admin.conf
    kubectl patch -n ingress-nginx configmap nginx-configuration -p '{"data":{"proxy-body-size": "{{kubernetes_ingress_proxy_size}}"}}'

# Set Master node as Loadbalancer
- name: Set Master node as Loadbalancer
  shell: |
    export KUBECONFIG=/etc/kubernetes/admin.conf
    kubectl patch -n ingress-nginx svc nginx-ingress-controller -p '{"spec":{"externalIPs":["{{ master_ip }}"]}}'